// Prisma schema for Ironing Service MVP

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums
enum Role {
  USER
  DELIVERY_PERSON
  FLOOR_MANAGER
  CENTER_OPERATOR
  ADMIN
}

enum TripStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}



enum OrderStatus {
  PLACED
  ASSIGNED_FOR_PICKUP
  PICKED_UP
  AT_CENTER
  PROCESSING
  QC
  READY_FOR_DELIVERY
  ASSIGNED_FOR_DELIVERY
  OUT_FOR_DELIVERY
  DELIVERED
  COMPLETED
  CANCELLED
  PICKUP_FAILED
  DELIVERY_FAILED
  REFUND_REQUESTED
}

enum DeliveryType {
  STANDARD
  PREMIUM
}



// Models
model User {
  id           String    @id @default(uuid())
  name         String
  email        String?   @unique
  phone        String    @unique
  passwordHash String?
  role         Role      @default(USER)
  referralCode String?   @unique
  referredBy   String?
  otpCodeHash  String?
  otpExpiresAt DateTime?
  createdAt    DateTime  @default(now())
}

model Address {
  id      String @id @default(uuid())
  userId  String
  address String
  lat     Float?
  lng     Float?
}

model Transaction {
  id          String   @id @default(uuid())
  userId      String
  type        String
  coins       Int
  description String
  createdAt   DateTime @default(now())

  @@index([userId, createdAt])
}





model Wallet {
  id      String @id @default(uuid())
  userId  String @unique
  coins   Int    @default(0)
}

model Service {
  id        String @id @default(uuid())
  name      String
  baseCoins Int
}

model Center {
  id           String @id @default(uuid())
  name         String
  address      String
  coverageKm   Float
  lat          Float
  lng          Float
}

model Timeslot {
  id        String @id @default(uuid())
  centerId  String
  startTime String
  endTime   String
}

model Trip {
  id               String     @id @default(uuid())
  deliveryPersonId String
  status           TripStatus @default(PENDING)
  scheduledDate    DateTime
  startTime        String
  endTime          String
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
}

model Order {
  id                    String       @id @default(uuid())
  userId                String
  addressId             String
  centerId              String?
  timeslotId            String
  pickupDate            DateTime
  tripId                String?
  status                OrderStatus  @default(PLACED)
  deliveryType          DeliveryType @default(STANDARD)
  deliveryChargeCoins   Int          @default(0)
  estimatedDeliveryTime DateTime?
  totalCoins            Int
  paymentMethod         String       @default("WALLET")
  alternatePhone        String?
  cancellationReason    String?
  pickupFailureReason   String?
  pickupOtpHash         String?
  pickupOtpExpiresAt    DateTime?
  deliveryOtpHash       String?
  deliveryOtpExpiresAt  DateTime?
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
}

model OrderItem {
  id        String @id @default(uuid())
  orderId   String
  serviceId String
  name      String
  quantity  Int
  coins     Int
}


